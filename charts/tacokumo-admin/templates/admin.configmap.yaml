apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "tacokumo-admin.fullname" . }}-config
  labels:
    {{- include "tacokumo-admin.labels" . | nindent 4 }}
data:
  config.yaml: |
    # Server configuration
    addr: {{ .Values.admin.config.addr }}
    port: {{ .Values.admin.config.port }}
    base_domain: {{ .Values.admin.config.baseDomain }}
    log_level: {{ .Values.admin.config.logLevel }}

    # Database configuration
    admin_db:
      host: ""        # Override via ADMIN_DB_HOST
      port: {{ .Values.admin.config.adminDb.port }}
      user: ""        # Override via ADMIN_DB_USER
      password: ""    # Override via ADMIN_DB_PASSWORD
      db_name: ""     # Override via ADMIN_DB_NAME
      initial_conn_retry: {{ .Values.admin.config.adminDb.initialConnRetry }}

    # Authentication configuration
    auth:
      client_id: ""          # Override via GITHUB_CLIENT_ID
      client_secret: ""      # Override via GITHUB_CLIENT_SECRET
      callback_url: {{ .Values.admin.config.auth.callbackUrl }}
      frontend_url: {{ .Values.admin.config.auth.frontendUrl }}
      github_org: ""         # Override via GITHUB_ORG
      session_ttl: {{ .Values.admin.config.auth.sessionTtl }}
      cookie_secure: {{ .Values.admin.config.auth.cookieSecure }}

    # Redis configuration
    redis:
      host: ""        # Override via REDIS_HOST
      port: {{ .Values.admin.config.redis.port }}
      password: ""    # Override via REDIS_PASSWORD
      db: {{ .Values.admin.config.redis.db }}
      initial_conn_retry: {{ .Values.admin.config.redis.initialConnRetry }}

    # CORS configuration
    cors:
      allow_origins: {{ .Values.admin.config.cors.allowOrigins }}
      allow_methods: {{ .Values.admin.config.cors.allowMethods }}
      allow_headers: {{ .Values.admin.config.cors.allowHeaders }}
      expose_headers: {{ .Values.admin.config.cors.exposeHeaders }}
      allow_credentials: {{ .Values.admin.config.cors.allowCredentials }}
      max_age: {{ .Values.admin.config.cors.maxAge }}

    # TLS configuration
    tls:
      enabled: {{ .Values.admin.config.tls.enabled }}
      cert_file: {{ .Values.admin.config.tls.certFile }}
      key_file: {{ .Values.admin.config.tls.keyFile }}

    {{- if .Values.admin.config.opentelemetry.enabled }}
    # OpenTelemetry configuration
    telemetry:
      enabled: {{ .Values.admin.config.opentelemetry.enabled }}
      otlp_endpoint: {{ .Values.admin.config.opentelemetry.otlpEndpoint }}
      timeout: "5s"
    {{- end }}